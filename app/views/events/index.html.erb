<% provide(:title, "Calendar of Appointments") %>

<div class="row-fluid">
  <div class="span12">
    <h1>Calendar of Appointments</h1>
  </div>
<div>

<div class="row-fluid">
  <div class="span12">
  <%= render 'shared/main_navigation' %>
  </div
</div>
<div id="appointments" class="row-fluid ">
  <div class="span12">
    <h2 id="month">
      <%= link_to "<", date: @date.prev_month %>
      <%= @date.strftime("%B %Y") %>
      <%= link_to ">", date: @date.next_month %>
    </h2>
    <%= calendar @date do |date| %>
      <%= date.day %>
      <% 1.upto(4) do |i| %>
      <ul>
        <% if @appointments_by_date[date] && @appointments_by_date[date].any? { |appointment| appointment.include_slot_number?(i) }
              appointment =  @appointments_by_date[date].find { |appointment| appointment.include_slot_number?(i) } %>
             <li>
                <%= link_to appointment.title, edit_appointment_path(appointment) %>
             </li>
        <% else %>
          <li> <%= link_to "Slot #{i}", new_appointment_path(starts_at: Appointment.starts_at_from_date_and_slot(date,i)) %> </li>
        <% end %>
      </ul>
      <% end %>

    <% end %>
  </div> <!-- span12 -->
</div> <!-- row-fluid appointments -->
